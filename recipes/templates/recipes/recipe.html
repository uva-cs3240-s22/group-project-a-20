{% extends "recipes/base.html" %}

{% load static %}
{% load custom_tags %}

{% block description %}Recipe information for {{ recipe.recipe_title }}{% endblock %}
{% block title %}{{ recipe.recipe_title }}{% endblock %}


{% block content %}

<div class="container main bg-light">
    <div class="row banner">
        <div class="col-9">
            <h1>{{ recipe.recipe_title }}</h1>
        </div>

        <div class="col-3">
            {% if user.is_authenticated %}
            <form action="{% url 'recipes:favorite' recipe.id user.id %}" method='POST' id="favorites-btn">
                {% csrf_token %}
                <input type="hidden" name="next" value="{{ request.path }}">

                {% if user in user_set %}
                <a href="#" onclick="document.getElementById('favorites-btn').submit();">
                    <i class="fas fa-heart js-heart heart active" id="heart"></i></a>
                Remove from favorites
                {% else %}
                <a href="#" onclick="document.getElementById('favorites-btn').submit();">
                    <i class="far fa-heart js-heart heart inactive" id="heart"></i></a>
                Add to favorites
                {% endif %}
            </form>
            {% endif %}
        </div>

        {% if recipe.parent %}
            <h5>Forked from <a href="{% url 'recipes:recipe' recipe.parent.id %}">{{ recipe.parent.recipe_title }}</a></h5>
        {% endif %}

    </div>
    <div class="row">

    </div>

    <div class="row">
    <!--        Block with the image-->
        <div class="col-4">
            {% if recipe.img %}
            <img src="{% static ''%}{{ recipe.img }}" class="recipe-img">
            {% endif %}
        </div>

    <!--        Block with the ingredients-->
        <div class="col-8 ingredients">
            <h3>Ingredients</h3>
            <ul>
                {% string_to_list recipe.recipe_ingredients as ingredients %}
                {% for element in ingredients %}

                <li>{{ element }} </li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <hr>

    <!--        Ideally block with all the instructions goes here.-->
    <div class="row instructions">
        <h3>Instructions</h3>
         <ol>
            {% string_to_list recipe.recipe_instructions as instructions %}
            {% for element in instructions %}

            <li>{{ element }} </li>
            <br>
            {% endfor %}
        </ol>
    </div>
    <hr>

    <!--        And forks go here. -->
    <div class="row list-of-forks">
        <a href="{% url 'recipes:forkrecipe' recipe.id %}"><button type="button" class="btn btn-primary"><i class="fa fa-utensils"></i></i> Fork Recipe</button></a>
         {% if recipe.recipe_set.all %}
            Forks:<br>
            {% for element in recipe.recipe_set.all %}
                <a href="{% url 'recipes:recipe' element.id %}">{{ element.recipe_title }}</a><br>
            {% endfor %}
        {% endif %}
    </div>
</div>

<hr class="comments-hr">

<div class="container bg-light comments">
    <div class="row comments-posted text-center">
        {% load comments %}
        <p>
        {% get_comment_count for object as comment_count %}
            {{ comment_count }} comment{{ comment_count|pluralize }}
            ha{{ comment_count|pluralize:"s,ve" }} been posted.
        </p>
    </div>

    {% if comment_count %}
    <div class="comment-list">
      {% render_comment_list for object %}
    </div>
    {% endif %}
    <div class="card card-block mb-5">
      <div class="card-body">
        <h4 class="card-title text-center pb-3">Post your comment</h4>
          {% render_comment_form for object %}
      </div>
    </div>
</div>

<script>
// gets a reference to the heartDOm
const heartDOM = document.querySelector('.js-heart');
    let liked = heartDOM.classList.contains("fas");
    console.log(liked);

// create a onclick listener
heartDOM.onclick = (event) => {
    // check if liked
    liked = !liked; // toggle the like ( flipping the variable)

    // this is what we clicked on
    const target = event.currentTarget;

    if (liked) {
        // remove empty heart if liked and add the full heart
        target.classList.remove('far');
        target.classList.add('fas', 'pulse');
    } else {
        // remove full heart if unliked and add empty heart
        target.classList.remove('fas');
        target.classList.add('far');
    }
}
// animation DOES NOT WORK
heartDOM.addEventListener('animationend', (event) => {
    event.currentTarget.classList.remove('pulse');
})
</script>

{% endblock %}

